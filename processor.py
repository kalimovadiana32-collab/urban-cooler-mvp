import cv2
import numpy as np

def process_thermal_image(image, base_temp, city_type):
    """–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã"""
    img_array = np.array(image.convert('RGB'))
    img_cv = cv2.cvtColor(img_array, cv2.COLOR_RGB2BGR)
    
    # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–æ–Ω
    zone_multipliers = {
        "–°—Ç–µ–ø–Ω–æ–π (–ê—Å—Ç–∞–Ω–∞)": 1.2,
        "–ü—Ä–µ–¥–≥–æ—Ä–Ω—ã–π (–ê–ª–º–∞—Ç—ã)": 1.1,
        "–ü—É—Å—Ç—ã–Ω–Ω—ã–π (–®—ã–º–∫–µ–Ω—Ç)": 1.4,
        "–£–º–µ—Ä–µ–Ω–Ω—ã–π": 1.0
    }
    multiplier = zone_multipliers.get(city_type, 1.0)
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ–ø–ª–æ–≤—É—é –º–∞—Å—Å—É (–∏–º–∏—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Å–ø–µ–∫—Ç—Ä–∞)
    gray = cv2.cvtColor(img_cv, cv2.COLOR_BGR2GRAY)
    heatmap = cv2.applyColorMap(gray, cv2.COLORMAP_JET)
    
    # –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —É—á–∞—Å—Ç–∫–∞
    avg_brightness = np.mean(gray)
    calculated_temp = base_temp + (avg_brightness / 255 * 10 * multiplier)
    
    return heatmap, round(calculated_temp, 1)

def get_ai_recommendations(temp_diff):
    """–ò–º–∏—Ç–∞—Ü–∏—è Space AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (—Å–æ–≤–µ—Ç—ã)"""
    if temp_diff > 5:
        return "‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≥—Ä–µ–≤! –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–º–µ–Ω–∞ 40% –∞—Å—Ñ–∞–ª—å—Ç–∞ –Ω–∞ —Å–≤–µ—Ç–ª—É—é –ø–ª–∏—Ç–∫—É –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ–¥–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤."
    elif temp_diff > 2:
        return "‚úÖ –£–º–µ—Ä–µ–Ω–Ω—ã–π –Ω–∞–≥—Ä–µ–≤. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ 15% –∑–µ–ª–µ–Ω—ã—Ö –Ω–∞—Å–∞–∂–¥–µ–Ω–∏–π —Å–Ω–∏–∑–∏—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –Ω–∞ 1.5¬∞C."
    else:
        return "üåü –û—Ç–ª–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –º–∏–∫—Ä–æ–∫–ª–∏–º–∞—Ç–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –æ–∑–µ–ª–µ–Ω–µ–Ω–∏—è."
