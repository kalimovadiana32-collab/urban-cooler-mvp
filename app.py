with st.expander("üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–Ω–∏–º–∫–∞–º"):
    st.markdown("""
    ### üõ∞Ô∏è –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
    1. **–ú–∞—Å—à—Ç–∞–±:** –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—ä–µ–º–∫–∏ ‚Äî **300‚Äì800 –º–µ—Ç—Ä–æ–≤**. –ù–∞ —Å–Ω–∏–º–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–µ—Ç–∫–æ —Ä–∞–∑–ª–∏—á–∏–º—ã –≥—Ä–∞–Ω–∏—Ü—ã –∫—Ä—ã—à –∏ –¥–æ—Ä–æ–∂–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ.
    2. **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–Ω–∏–º–∫–∏ –æ—Ç **1280x720 –ø–∏–∫—Å–µ–ª–µ–π** –∏ –≤—ã—à–µ. –ß–µ–º —á–µ—Ç—á–µ –≥—Ä–∞–Ω–∏—Ü—ã –æ–±—ä–µ–∫—Ç–æ–≤, —Ç–µ–º –º–µ–Ω—å—à–µ "—à—É–º–∞" –≤ —Ç–µ–ø–ª–æ–≤—ã—Ö —Ä–∞—Å—á–µ—Ç–∞—Ö.
    3. **–†–∞–∫—É—Ä—Å:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ **–Ω–∞–¥–∏—Ä–Ω—ã–µ —Å–Ω–∏–º–∫–∏** (–≤–∏–¥ —Å—Ç—Ä–æ–≥–æ —Å–≤–µ—Ä—Ö—É –ø–æ–¥ —É–≥–ª–æ–º 90¬∞). –ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ —Å–Ω–∏–º–∫–∏ (–ø–æ–¥ —É–≥–ª–æ–º) –∏—Å–∫–∞–∂–∞—é—Ç —Ä–∞—Å—á–µ—Ç –ø–ª–æ—â–∞–¥–∏ –∑–∞—Å—Ç—Ä–æ–π–∫–∏.
    4. **–û—Å–≤–µ—â–µ–Ω–∏–µ:** –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–æ—Å—Ç–∏–≥–∞—é—Ç—Å—è –Ω–∞ —Å–Ω–∏–º–∫–∞—Ö, —Å–¥–µ–ª–∞–Ω–Ω—ã—Ö –≤ **—Å–æ–ª–Ω–µ—á–Ω—ã–π –ø–æ–ª–¥–µ–Ω—å**. –ò–º–µ–Ω–Ω–æ —Ç–æ–≥–¥–∞ —Ä–∞–∑–Ω–∏—Ü–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –º–µ–∂–¥—É –∞—Å—Ñ–∞–ª—å—Ç–æ–º –∏ —Ç–µ–Ω—è–º–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞.
    
    ### ‚ö†Ô∏è –ß–µ–≥–æ —Å—Ç–æ–∏—Ç –∏–∑–±–µ–≥–∞—Ç—å:
    * –°–Ω–∏–º–∫–æ–≤ —Å –ø–ª–æ—Ç–Ω–æ–π –æ–±–ª–∞—á–Ω–æ—Å—Ç—å—é (–∑–∞–∫—Ä—ã–≤–∞—é—Ç –æ–±–∑–æ—Ä).
    * –°–Ω–∏–º–∫–æ–≤, –≥–¥–µ –±–æ–ª–µ–µ 50% –∑–∞–Ω–∏–º–∞—é—Ç –Ω–∞–¥–ø–∏—Å–∏ –∏–ª–∏ –≤–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏.
    * –ß—Ä–µ–∑–º–µ—Ä–Ω–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ (–≥–¥–µ –≤–µ—Å—å –≥–æ—Ä–æ–¥ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ–¥–∏–Ω —ç–∫—Ä–∞–Ω).
    """)
import streamlit as st
import cv2
import numpy as np
from PIL import Image

# –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–≤–æ–µ–π –±–∞–∑–æ–π, –Ω–æ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
def process_thermal(img, ambient_temp):
    img = np.array(img)
    img_bgr = cv2.cvtColor(img, cv2.COLOR_RGB2BGR)
    gray = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2GRAY)
    hsv = cv2.cvtColor(img_bgr, cv2.COLOR_BGR2HSV)

    mask_cool = cv2.bitwise_or(cv2.inRange(hsv, np.array([33, 10, 10]), np.array([95, 255, 255])), cv2.inRange(gray, 0, 75))
    mask_cool = cv2.morphologyEx(mask_cool, cv2.MORPH_CLOSE, np.ones((5,5), np.uint8))
    
    mask_warm = cv2.adaptiveThreshold(gray, 255, cv2.ADAPTIVE_THRESH_GAUSSIAN_C, cv2.THRESH_BINARY, 145, -30)
    mask_warm = cv2.bitwise_and(mask_warm, cv2.bitwise_not(mask_cool))
    mask_warm = cv2.morphologyEx(mask_warm, cv2.MORPH_CLOSE, np.ones((7,7), np.uint8))
    
    mask_heat = cv2.bitwise_and(cv2.inRange(hsv, np.array([0, 0, 45]), np.array([180, 85, 185])), cv2.bitwise_not(mask_warm))
    mask_heat = cv2.bitwise_and(mask_heat, cv2.bitwise_not(mask_cool))
    mask_heat = cv2.morphologyEx(mask_heat, cv2.MORPH_CLOSE, np.ones((9,9), np.uint8))

    overlay = img_bgr.copy()
    overlay[mask_cool > 0] = [240, 80, 0]   # –°–∏–Ω–∏–π
    overlay[mask_warm > 0] = [0, 140, 255]  # –û—Ä–∞–Ω–∂–µ–≤—ã–π
    overlay[mask_heat > 0] = [10, 10, 230]  # –ö—Ä–∞—Å–Ω—ã–π
    
    res = cv2.addWeighted(img_bgr, 0.3, overlay, 0.7, 0)
    
    total = img.shape[0] * img.shape[1]
    stats = {
        "heat": (np.sum(mask_heat > 0) / total * 100, ambient_temp + 8.5),
        "warm": (np.sum(mask_warm > 0) / total * 100, ambient_temp + 2.3),
        "cool": (np.sum(mask_cool > 0) / total * 100, ambient_temp - 10.2)
    }
    return cv2.cvtColor(res, cv2.COLOR_BGR2RGB), stats

# --- –î–ò–ó–ê–ô–ù –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
st.set_page_config(page_title="Thermal AI Pro", layout="wide", initial_sidebar_state="expanded")

# –ö–∞—Å—Ç–æ–º–Ω—ã–π CSS –¥–ª—è —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –∏ —à—Ä–∏—Ñ—Ç–æ–≤
st.markdown("""
    <style>
    .main { background-color: #0e1117; }
    .stMetric { background-color: #1e2130; padding: 15px; border-radius: 10px; border: 1px solid #3e4253; }
    [data-testid="stSidebar"] { background-color: #161b22; }
    h1 { color: #ff4b4b; font-family: 'Courier New', Courier, monospace; }
    </style>
    """, unsafe_allow_html=True)

st.title("üõ∞Ô∏è THERMAL VISION SYSTEM v2.0")
st.markdown("---")

# –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/2504/2504945.png", width=100)
    st.header("Control Panel")
    t_air = st.slider("Ambient Temperature (¬∞C)", 10, 50, 30)
    uploaded_file = st.file_uploader("Upload Satellite Image", type=['jpg', 'png', 'jpeg'])
    st.info("System calibrated for urban heat islands analysis.")

if uploaded_file:
    img_input = Image.open(uploaded_file)
    processed_img, metrics = process_thermal(img_input, t_air)
    
    # –°–µ—Ç–∫–∞ –∏–∑ –º–µ—Ç—Ä–∏–∫ (–ö—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏)
    col1, col2, col3 = st.columns(3)
    col1.metric("üî• MAX HEAT", f"{metrics['heat'][1]:.1f} ¬∞C", f"{metrics['heat'][0]:.1f}% Area", delta_color="inverse")
    col2.metric("üè† WARM ZONES", f"{metrics['warm'][1]:.1f} ¬∞C", f"{metrics['warm'][0]:.1f}% Area")
    col3.metric("üå≤ COOL ZONES", f"{metrics['cool'][1]:.1f} ¬∞C", f"-{metrics['cool'][0]:.1f}% Area", delta_color="normal")
    
    st.markdown("### Analysis Preview")
    
    # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –û—Ä–∏–≥–∏–Ω–∞–ª / –¢–µ–ø–ª–æ–≤–∏–∑–æ—Ä
    c1, c2 = st.columns(2)
    with c1:
        st.caption("Original RGB Feed")
        st.image(img_input, use_container_width=True)
    with c2:
        st.caption("Thermal Spectrum Reconstruction")
        st.image(processed_img, use_container_width=True)
        
    # –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞
    st.download_button(label="üì• Download Full Report", data=uploaded_file, file_name="thermal_analysis.png", mime="image/png")
else:
    st.warning("üì° Waiting for satellite data input... Please upload an image in the sidebar.")
